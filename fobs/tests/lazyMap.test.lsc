import { createBehaviorSubject, map, toBehaviorSubject, test } from '..'

describe! 'lazyMap', (): void ->
  it! 'should work', ->
    obs1 = createBehaviorSubject()
    obs1.next(0)
    m = map! obs1, (x) ->
      console.log("mapping", x)
      x+1
    lm = toBehaviorSubject(m)

    sub = test(lm, console.log.bind(console, "sub1"), [
      (x) -> x == 1
      (x) -> x == 2
      'complete'
    ])

    sub2 = test(lm, console.log.bind(console, "sub2"), [
      (x) -> x == 1
      (x) -> x == 2
      'complete'
    ])

    obs1.next(1)
    obs1.complete()
    sub.unsubscribe()
    sub2.unsubscribe()
