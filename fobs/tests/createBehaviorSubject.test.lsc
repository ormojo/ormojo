import { createBehaviorSubject, test } from '..'

describe! 'createBehaviorSubject', (): void ->
  it! 'emits undefined when unprimed', ->
    subj = createBehaviorSubject()

    test(subj, console.log.bind(console), [
      (x) -> x == undefined
      'complete'
      'failure'
    ])

    subj.complete()

  it! 'doesnt emit undefined when unprimed', ->
    subj = createBehaviorSubject({ emitBeforeNext: false })

    test(subj, console.log.bind(console), [
      'complete'
      'failure'
    ])

    subj.complete()

  it! 'should work', ->
    subj = createBehaviorSubject()

    subj.next(1)

    test(subj, console.log.bind(console), [
      (x) -> x == 1
      (x) -> x == 2
      (x) -> x == 3
      'complete'
      'failure'
    ])

    subj.next(2); subj.next(3); subj.complete()

  it! 'onlyWhen', ->
    subj = createBehaviorSubject()

    subj.next(1)

    test(subj, console.log.bind(console), [
      (x) -> x == 1
      (x) -> x == 1
      'complete'
      'failure'
    ])

    subj.next(1); subj.complete()

    subj2 = createBehaviorSubject({onlyWhen: (a,b) -> a != b})
    subj2.next(1)
    test(subj2, console.log.bind(console), [
      (x) -> x == 1
      'complete'
      'failure'
    ])
    subj2.next(1); subj2.complete()

  it! 'unsubscribe', ->
    subj = createBehaviorSubject()

    sub = subj.subscribe({
      next(x) -> console.log(x)
    })

    subj.next(1)

    sub.unsubscribe()

    subj.next(2)
    subj.complete()
