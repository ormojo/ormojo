'use @oigroup/lightscript'

export default field(spec) ->
  (proto, key, descriptor) ->
    // Inherit fields from parent as a separate object so mutations
    // don't confuse parent
    if not Object.prototype.hasOwnProperty.call(proto, 'fields'):
      proto.fields = Object.assign({}, proto.fields)

    // Prevent constructor from calling initializer
    spec.defaulter = descriptor.initializer
    descriptor.initializer = null

    proto.fields[key] = spec
    descriptor
