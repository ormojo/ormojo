'use @oigroup/lightscript with flippedImports'

import '@ormojo/ephraim': {
  entity, field
}

test! "required entity fields", ->
  @entity() class E:
    @field() f = "default"

  @entity() class D:
    @field(E) subE

  @entity() class F:
    @field() f = "defaultF"

  @entity() class G extends E:
    @field() g = "defaultG"

  d = new D

  expect!
    -> d.subE = new F
    .toThrow("Value assigned to 'subE' must be of type 'E', was of type 'F'")

  d.subE = new E
  expect(d.subE.f).toBe("default")

  d.subE = new G
  expect(d.subE.g).toBe("defaultG")
